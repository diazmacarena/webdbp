<!DOCTYPE html>
<html lang="es-PE">

<head>
	<%- include('partials/head') %>
</head>

<body>
	<%- include('partials/header') %>
	<div class="container">
		<div class="main-content">
			<div class="section">
				<h3>CAUSAS</h3>
				<p>El estr√©s acad√©mico puede ser causado por diversas razones, como la presi√≥n por obtener buenas
					calificaciones, la carga excesiva de trabajo, la falta de organizaci√≥n y la ansiedad por los ex√°menes.</p>
				<div class="resource-links">
					<div class="resource-link">
						<a href="https://www.youtube.com/watch?v=P21av6o-qVY">Video: Estr√©s ¬øCausas?</a>
					</div>
					<div class="resource-link">
						<a href="https://www.youtube.com/watch?v=8zVyYBEKtoU">Video: Causas y consecuencias del estr√©s acad√©mico
						</a>
					</div>
					<div class="resource-link">
						<a href="https://www.youtube.com/watch?v=rF-Vw2uR1LQ">¬øQu√© es el estr√©s acad√©mico? con el Dr. Alejandro
							Lanuque
						</a>
					</div>
					<div class="resource-link">
						<a href="https://www.mariajesuscampos.es/el-estres-academico-causas/">Blog: Estr√©s acad√©mico: Causas</a>
					</div>
					<div class="resource-link">
						<a href="https://revmultimed.sld.cu/index.php/mtm/article/view/302/410">Art√≠culo: Estr√©s acad√©mico: causas y
							consecuencias</a>
					</div>
					<div class="resource-link">
						<a
							href="https://uchile.cl/presentacion/centro-de-aprendizaje-campus-sur/Material-Autorregulacion-Emocional/reconocer-prevenir-y-afrontar-el-estres-academico">Reconocer,
							prevenir y afrontar el estr√©s acad√©mico
						</a>
					</div>
				</div>
			</div>

			<div class="section warning-signs">
				<h3>SIGNOS DE ALERTA</h3>
				<a href="/quiz" class="quiz-btn">Toma el quiz para detectar
					signos de alerta</a>
				<p>Los signos de estr√©s acad√©mico incluyen dificultad para concentrarse, insomnio, fatiga, ansiedad,
					irritabilidad y disminuci√≥n en el rendimiento</p>
				<div class="resource-links">
					<div class="resource-link">
						<a href="https://youtu.be/q9tM64Meyj0">Se√±ales de alerta escolar</a>
					</div>
					<div class="resource-link">
						<a href="https://www.youtube.com/watch?v=hP1kbyK39-A">Los s√≠ntomas f√≠sicos m√°s comunes del
							estr√©s
						</a>
					</div>
					<div class="resource-link">
						<a href="https://www.youtube.com/watch?v=Ox7_4rNkLHk">As√≠ afecta el ESTR√âS a nuestro CUERPO
						</a>
					</div>
					<div class="resource-link">
						<a href="https://www.youtube.com/watch?v=xzk-frBs9ro">S√≠ntomas del estr√©s
						</a>
					</div>
					<div class="resource-link">
						<a href="https://youtu.be/X-T6Dqqy8gQ">10 signos que tu cuerpo tiene mucho estr√©s - Dr. Carlos Jaramillo
						</a>
					</div>
					<div class="resource-link">
						<a href="https://www.youtube.com/watch?v=ewtMyjjuaRY">üëâ¬øEstr√©s acad√©mico? üòï
						</a>
					</div>
				</div>
			</div>
		</div>

		<div class="section" id="consejos">
			<h3>CONSEJOS</h3>
			<ol class="tips-list">
				<li>Organiza tu tiempo.</li>
				<li>Haz ejercicio.</li>
				<li>Duerme bien.</li>
				<li>Mant√©n una dieta equilibrada.</li>
				<li>Pide ayuda.</li>
				<li>Practica t√©cnicas de relajaci√≥n.</li>
				<li>Establece metas peque√±as y alcanzables.</li>
				<li>Mant√©n un equilibrio.</li>
				<li>Habla sobre tus preocupaciones.</li>
				<li>Evita la procrastinaci√≥n.</li>
			</ol>
		</div>

		<div class="section forum" id="foro">
			<h3>FORO DE DISCUSI√ìN</h3>
			<div class="forum-header">
				<p>¬°Bienvenido a nuestra comunidad! Comparte tus experiencias, haz preguntas y ayuda a otros estudiantes que
					est√°n lidiando con el estr√©s acad√©mico.</p>
			</div>
		
			<div class="forum-actions">
				<button class="btn btn-primary" id="new-topic-btn">
					<i class="fas fa-plus"></i> Nuevo Tema
				</button>
			</div>
		
			<div class="forum-topics">
				<% temas.forEach((tema) => { %>
					<div class="forum-topic" data-id="<%= tema.id %>">
						<div class="topic-title"><%= tema.title %></div>
						<div class="topic-meta">
							<div class="topic-author">
								<div class="topic-avatar"><%= tema.author.substring(0, 2).toUpperCase() %></div>
								<span><%= tema.author %></span>
							</div>
							<div class="topic-stats">
								<div class="topic-stat">
									<i class="far fa-comment"></i> <%= tema.comments ? tema.comments.length : 0 %> respuestas
								</div>
								<div class="topic-stat">
									<i class="far fa-clock"></i> <%= new Date(tema.createdAt).toLocaleDateString() %>
								</div>
							</div>
						</div>
						<div class="topic-content"><%= tema.content %></div>
						<div class="topic-tags">
							<% tema.tags.forEach(function(tag) { %>
								<span class="topic-tag"><%= tag %></span>
							<% }); %>
						</div>
		
						<div class="topic-replies">
							<% if (tema.comments && tema.comments.length > 0) { %>
								<% tema.comments.forEach(function(comment, index) { %>
									<div class="forum-reply <%= comment.accepted ? 'accepted-reply' : '' %>" data-id="<%= comment.id %>">
										<div class="reply-header">
											<div class="reply-avatar"><%= comment.author ? comment.author.substring(0, 2).toUpperCase() : 'UA' %></div>
											<span class="reply-username"><%= comment.author || 'Usuario An√≥nimo' %></span>
											<span class="reply-date"><%= new Date(comment.date).toLocaleDateString() %></span>
											<% if (comment.accepted) { %>
												<span class="accepted-badge">Respuesta aceptada</span>
											<% } %>
										</div>
										<div class="reply-content"><%= comment.text %></div>
										<div class="reply-actions">
											<div class="reply-action">
												<i class="far fa-thumbs-up"></i> <%= comment.likes || 0 %>
											</div>
											<div class="reply-action">
												<i class="fas fa-reply"></i> Responder
											</div>
										</div>
									</div>
								<% }); %>
							<% } %>
						</div>
		
						<div class="reply-form">
							<div class="form-group">
								<textarea class="comment-input" placeholder="Escribe tu respuesta..."></textarea>
							</div>
							<div class="form-actions">
								<button type="button" class="btn btn-secondary">Cancelar</button>
								<button type="button" class="btn btn-primary">Publicar respuesta</button>
							</div>
						</div>
					</div>
				<% }); %>
			</div>
	
		
			<!-- Formulario para nuevo tema (oculto inicialmente) -->
			<div class="new-topic-form" id="new-topic-form" style="display: none;">
				<div class="form-title">Crear nuevo tema de discusi√≥n</div>
				<div class="form-group">
					<label for="topic-title">T√≠tulo del tema</label>
					<input type="text" id="topic-title" placeholder="Escribe un t√≠tulo claro y descriptivo">
				</div>
				<div class="form-group">
					<label for="topic-content">Contenido</label>
					<textarea id="topic-content" placeholder="Describe tu pregunta, experiencia o tema de discusi√≥n con detalle"></textarea>
				</div>
				<div class="form-group">
					<label for="topic-tags">Etiquetas (separadas por comas)</label>
					<input type="text" id="topic-tags" placeholder="Ej: ex√°menes, ansiedad, organizaci√≥n">
				</div>
				<div class="form-actions">
					<button class="btn btn-secondary" id="cancel-topic-btn">Cancelar</button>
					<button class="btn btn-primary">Publicar tema</button>
				</div>
			</div>
		</div>
	</div>

	<footer>
		<p>&copy; 2025 - Estr√©s Acad√©mico</p>
	</footer>

	<script>
		document.addEventListener('DOMContentLoaded', function() {
    const newTopicBtn = document.getElementById('new-topic-btn');
    const newTopicForm = document.getElementById('new-topic-form');
    const cancelTopicBtn = document.getElementById('cancel-topic-btn');
    const forumTopics = document.querySelector('.forum-topics');
    
    // Mostrar/ocultar formulario de nuevo tema
    newTopicBtn.addEventListener('click', function() {
        newTopicForm.style.display = 'block';
        newTopicBtn.style.display = 'none';
        newTopicForm.scrollIntoView({ behavior: 'smooth' });
    });

    cancelTopicBtn.addEventListener('click', function() {
        newTopicForm.style.display = 'none';
        newTopicBtn.style.display = 'block';
    });

    // Funcionalidad para guardar nuevo tema
    const publishTopicBtn = newTopicForm.querySelector('.btn.btn-primary');
    publishTopicBtn.addEventListener('click', function() {
        const titleInput = document.getElementById('topic-title').value.trim();
        const contentInput = document.getElementById('topic-content').value.trim();
        const tagsInput = document.getElementById('topic-tags').value.trim();
        
        if (titleInput && contentInput) {
            const newTopic = {
                title: titleInput,
                content: contentInput,
                tags: tagsInput.split(',').map(tag => tag.trim()),
                author: 'Usuario An√≥nimo', // Podr√≠as cambiarlo si hay usuarios
                comments: [],
                createdAt: new Date().toISOString()
            };
            // Aqu√≠ en lugar de guardar en localStorage, deber√≠as enviar el nuevo tema al servidor
            // mediante una petici√≥n POST
            fetch('/temas', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(newTopic)
            })
            .then(response => response.json())
            .then(data => {
                // Refrescar la p√°gina para mostrar el nuevo tema
                window.location.reload();
            })
            .catch(error => {
                console.error('Error al guardar el tema:', error);
                alert('Ocurri√≥ un error al guardar el tema. Por favor, intenta de nuevo.');
            });

            newTopicForm.style.display = 'none';
            newTopicBtn.style.display = 'block';
            document.getElementById('topic-title').value = '';
            document.getElementById('topic-content').value = '';
            document.getElementById('topic-tags').value = '';
        } else {
            alert('Por favor, completa el t√≠tulo y contenido del tema.');
        }
    });

    // Script para manejar los comentarios en los temas con autenticaci√≥n
document.querySelectorAll('.forum-topic').forEach(topicDiv => {
    const replyButton = topicDiv.querySelector('.reply-form .btn-primary');
    if (replyButton) {
        replyButton.addEventListener('click', function() {
            // Verificar si el usuario est√° autenticado
            const isAuthenticated = <%= user ? 'true' : 'false' %>;
            
            if (!isAuthenticated) {
                const topicId = topicDiv.dataset.id;
                alert('Debes iniciar sesi√≥n para comentar.');
                window.location.href = `/login?redirect=/#${topicId}`;
                return;
            }
            
            const textarea = topicDiv.querySelector('.reply-form textarea');
            const replyText = textarea.value.trim();
            const topicId = topicDiv.dataset.id;
            
            if (replyText && topicId) {
                // Enviar respuesta al servidor
                fetch(`/temas/${topicId}/comentarios`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: replyText
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        // Si hay error de autenticaci√≥n, redirigir al login
                        if (response.status === 401 || response.status === 403) {
                            alert('Tu sesi√≥n ha expirado. Por favor inicia sesi√≥n nuevamente.');
                            window.location.href = `/login?redirect=/#${topicId}`;
                            return;
                        }
                        throw new Error('Error al publicar comentario');
                    }
                    return response.json();
                })
                .then(data => {
                    // Refrescar la p√°gina para mostrar el nuevo comentario
                    window.location.reload();
                })
                .catch(error => {
                    console.error('Error al guardar el comentario:', error);
                    alert('Ocurri√≥ un error al guardar el comentario. Por favor, intenta de nuevo.');
                });
                
                textarea.value = '';
            }
        });
    }
});

// Actualizar la funcionalidad para "me gusta" en los comentarios
document.querySelectorAll('.reply-action').forEach(action => {
    if (action.querySelector('.fa-thumbs-up')) {
        action.addEventListener('click', function() {
            // Verificar si el usuario est√° autenticado
            const isAuthenticated = <%= user ? 'true' : 'false' %>;
            
            if (!isAuthenticated) {
                alert('Debes iniciar sesi√≥n para dar "me gusta".');
                window.location.href = '/login?redirect=/';
                return;
            }
            
            const replyElement = action.closest('.forum-reply');
            const topicElement = action.closest('.forum-topic');
            
            if (replyElement && topicElement) {
                const commentId = replyElement.dataset.id;
                const topicId = topicElement.dataset.id;
                
                // Enviar "me gusta" al servidor
                fetch(`/comentarios/${topicId}/${commentId}/like`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 401 || response.status === 403) {
                            alert('Tu sesi√≥n ha expirado. Por favor inicia sesi√≥n nuevamente.');
                            return;
                        }
                        throw new Error('Error al dar "me gusta"');
                    }
                    return response.json();
                })
                .then(data => {
                    // Actualizar el contador de "me gusta" en la interfaz
                    const countElement = action.querySelector('i').nextSibling;
                    countElement.nodeValue = ` ${data.likes}`;
                    action.style.color = '#a93226';
                })
                .catch(error => {
                    console.error('Error al dar "me gusta":', error);
                });
            }
        });
    }
});
	</script>
</body>

</html>
